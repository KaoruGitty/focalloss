# CFL (Cost-sensitive Focal Loss) 検証計画書

## 1. 検証の目的
- 「動的な重み（α）」による地雷ミス（中→日）の抑制効果を定量化する。
- クラス不均衡を解消するFLのα[3, 1, 2]と、組み合わせコスト（行列）の相乗効果を確認する。
- Focal部（γ）の有無が、長期的な学習の安定性と精度に与える影響を明らかにする。

---

## 2. 短期検証（数エポック：挙動確認フェーズ）
初期の勾配の出方や、特定のミスへの反応速度を確認し、長期検証に進む設定を選別する。

| ID | 検証項目 | コスト行列 (Cost Matrix) | γ (Gamma) | 狙い・チェックポイント |
|:---|:---|:---|:---|:---|
| **V1** | 基本CFL | `[[1,2,3],[2,1,3],[3,2,1]]` | 2 | 標準的なコスト設定での地雷抑制力の確認。 |
| **V2** | FL重み融合型 | `[[3,6,9],[2,1,3],[6,4,2]]` | 2 | クラス別α[3,1,2]をベースに対角線を設定。 |
| **V3** | 低ガンマ検証 | `[[1,2,3],[2,1,3],[3,2,1]]` | 1 | Focal項を弱めた際の学習の安定性と収束速度。 |

---

## 3. 長期検証（50エポック：精度確定フェーズ）
モデルの収束性能と、最終的な「地雷率」の低下、および全体の正解率を確定させる。

| ID | 検証項目 | 設定内容 | 狙い・期待される結果 |
|:---|:---|:---|:---|
| **L1** | ベースライン | **純粋なFocal Loss (αなし)** | CFLを導入しない場合の基準スコア。 |
| **L2** | **Focalなし検証** | **CFL行列(V1) + γ=0** | **αとCEのみで長期回した場合の精度（比較用）。** |
| **L3** | **V2強化版検証** | V2行列のコスト強度UP | 地雷コストをさらに強化し、安定性と精度の限界を確認。 |
| **L4** | CFL本検証 | 短期検証のベスト設定 | 長期的な収束の安定性と地雷率の最終低下幅。 |

---

## 4. 評価の着眼点（Confusion Matrixの分析）

1. **特定セルの減少速度**:
   - 「中→日」セルの値が、通常のミス（中→英）より優先的に減少しているか。
2. **Focal部の寄与 (L2 vs L4)**:
   - γ=0 (L2) よりも γ=2 (L4) の方が、地雷候補となる「難しいデータ」を効果的に修正できているか。
3. **L3における安定性**:
   - コストを強化した際に、Lossが振動せずに「地雷」をさらに駆逐できているか。

---

## 5. コスト行列の設計（V2 / L3 用）
`Target (行) x Prediction (列)`

| 正解 \ 予測 | 0: 日 | 1: 英 | 2: 中 | 備考 |
|:---|:---:|:---:|:---:|:---|
| **0: 日** | **3.0** | 6.0 | 9.0 | 日が正解：中への誤読を最大警戒 |
| **1: 英** | 2.0 | **1.0** | 3.0 | 英が正解：中への誤読を警戒 |
| **2: 中** | **6.0** | 4.0 | **2.0** | 中が正解：日への誤読を最大警戒 |
