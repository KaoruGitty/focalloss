# CFL (Cost-sensitive Focal Loss) 検証プラン

## 1. 検証の目的
- 「動的な重み（α）」による地雷ミス（中→日）の抑制効果を定量化する。
- クラス不均衡を解消するFLのα[3, 1, 2]と、組み合わせコスト（行列）の相乗効果を確認する。
- Focal部（γ）を外した際の挙動を比較し、各コンポーネントの必要性を検証する。

---

## 2. 短期検証（数エポック：挙動確認フェーズ）
初期の勾配の出方や、特定のミスへの反応速度を確認し、長期検証に進む設定を選別する。

| ID | 検証項目 | コスト行列 (Cost Matrix) | γ (Gamma) | 狙い・チェックポイント |
|:---|:---|:---|:---|:---|
| **V1** | 基本CFL | `[[1,2,3],[2,1,3],[3,2,1]]` | 2 | 標準的なコスト設定での地雷抑制力の確認。 |
| **V2** | FL重み融合型 | `[[3,6,9],[2,1,3],[6,4,2]]` | 2 | クラス別α[3,1,2]をベースに倍率を適用。 |
| **V3** | 低ガンマ検証 | `[[1,2,3],[2,1,3],[3,2,1]]` | 1 | Focal項を弱めた際の学習の安定性と収束速度。 |
| **V4** | **Focalなし** | `[[1,2,3],[2,1,3],[3,2,1]]` | **0** | **αとCEのみの効果を確認（比較用）。** |

---

## 3. 長期検証（50エポック：精度確定フェーズ）
最終的なモデルの安定性と、Confusion Matrixの改善度を確定させる。

| ID | 検証項目 | 設定 | 狙い・期待される結果 |
|:---|:---|:---|:---|
| **L1** | ベースライン | **純粋なFocal Loss (αなし)** | CFLを導入しない場合の基準スコア。 |
| **L2** | CFL本検証 | 短期検証のベスト設定 | 長期的な収束の安定性と地雷率の最終低下幅。 |
| **L3** | 強度感度分析 | 地雷コストをさらに強化 (例:10倍) | 重みの限界点（学習が不安定にならないか）の確認。 |

---

## 4. 評価の着眼点（Confusion Matrixの分析）

CFLが正しく機能している場合、以下の傾向が見られるはずです。

1. **特定セルの減少**:
   - `Target: 中` に対して `Pred: 日` となっているセルの値が、他のミス（中→英）より優先的に減少しているか。
2. **「逃げ」の許容範囲**:
   - 地雷を避けるために「英」への誤変換が増えても、全体の Accuracy がベースライン(L1)を大きく下回っていないか。
3. **Focal部の寄与 (V4 vs V1)**:
   - γ=0 (V4) の時よりも、γ=2 (V1) の方が、地雷候補となる「難しいデータ」に対して強い修正力が働いているか。

---

## 5. 使用するコスト行列（検証V2用）の詳細
`Target (行) x Prediction (列)`

| 正解 \ 予測 | 0: 日 | 1: 英 | 2: 中 | 備考 |
|:---|:---:|:---:|:---:|:---|
| **0: 日** | **3.0** | 6.0 | 9.0 | 日が正解：中への誤読を最大警戒 |
| **1: 英** | 2.0 | **1.0** | 3.0 | 英が正解：中への誤読を警戒 |
| **2: 中** | **6.0** | 4.0 | **2.0** | 中が正解：日への誤読を最大警戒 |
